<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/header :: header-css">
</head>

<body>
<div th:replace="fragments/header :: header"></div>

<div class="container">
    <div class="row" style="margin-top:20px">
        <div class="col-lg-8 offset-lg-2">
            <div class="card">
                <div class="card-body">
                    <h1 class="card-title text-center mb-4" th:text="#{admin.create.product}"></h1>
                    <form autocomplete="off" th:object="${productForm}" class="form" method="POST"
                          enctype="multipart/form-data">
                        <div class="form-group">
                            <label th:text="#{product.name}"></label>
                            <input type="text" th:field="*{name}" class="form-control input-lg" title="name"
                                   autofocus="true" />
                            <div class="alert alert-danger error-alert" th:if="${#fields.hasErrors('name')}"
                                 th:errors="*{name}"></div>
                        </div>
                        <div class="form-group">
                            <label th:text="#{product.category}"></label>
                            <select class="form-control input-lg" th:field="*{category.id}" name="category.id"
                                    autofocus="true">
                                <option value="0">select</option>
                                <option th:each="cat : ${categories}" th:value="${cat.id}"
                                        th:text="${cat.categoryName}"></option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label th:text="#{product.desc}"></label>
                            <input type="text" th:field="*{description}" class="form-control input-lg" title="description"
                                   autofocus="false" />
                            <div class="alert alert-danger error-alert" th:if="${#fields.hasErrors('description')}"
                                 th:errors="*{description}"></div>
                        </div>
                        <div class="form-group">
                            <label th:text="#{product.price}"></label>
                            <input type="search" th:field="*{price}" class="form-control input-lg" title="price"
                                   autofocus="false" />
                            <div class="alert alert-danger error-alert" th:if="${#fields.hasErrors('price')}"
                                 th:errors="*{price}"></div>
                        </div>
                        <div class="form-group">
                            <label th:text="#{product.image}"></label>
                            <input type="file" th:field="*{imageFile}" name="img" class="form-control input-lg" title="imageFile"
                                   autofocus="false" onchange="showPreview(event)" />
                            <div class="alert alert-danger error-alert" th:if="${#fields.hasErrors('imageFile')}"
                                 th:errors="*{imageFile}"></div>
                            <img id="preview" src="#" alt="Preview" class="img-thumbnail mt-2" style="max-width: 400px; display: none;">
                        </div>

                        <div class="text-center">
                            <input th:if="${method} == 'new'" class="btn btn-primary" type="submit"
                                   th:action="@{/product/new}" th:value="#{product.confirm}" />
                            <input th:if="${method} == 'edit'" class="btn btn-secondary" type="submit"
                                   th:action="@{/product/edit/{productId}}" th:value="#{product.cancel}" />
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:replace="fragments/footer :: footer"></div>
<script>
    function showPreview(event) {
        if (event.target.files && event.target.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById("preview").setAttribute("src", e.target.result);
                document.getElementById("preview").style.display = "block";
            }
            reader.readAsDataURL(event.target.files[0]);
        }
    }
</script>
</body>

</html>
